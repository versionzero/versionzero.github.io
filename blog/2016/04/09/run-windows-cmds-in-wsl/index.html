<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://versionzero.org/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://versionzero.org/theme/stylesheet/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://versionzero.org/theme/stylesheet/font-awesome.min.css">


    <link href="http://versionzero.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="versionzero Atom">



  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

<meta name="author" content="Ben Burnett" />
<meta name="description" content="They said it couldn't be done." />
<meta name="keywords" content="Windows, Linux">
<meta property="og:site_name" content="versionzero"/>
<meta property="og:title" content="Run Windows commands from the Windows Subsystem for Linux"/>
<meta property="og:description" content="They said it couldn't be done."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://versionzero.org/blog/2016/04/09/run-windows-cmds-in-wsl/index.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-04-09 12:00:00-06:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://versionzero.org/author/ben-burnett.html">
<meta property="article:section" content="Systems"/>
<meta property="article:tag" content="Windows"/>
<meta property="article:tag" content="Linux"/>
<meta property="og:image" content="">
  <title>versionzero &ndash; Run Windows commands from the Windows Subsystem for Linux</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://versionzero.org">
        <img src="http://versionzero.org/theme/img/profile.png" alt="" title="">
      </a>
      <h1><a href="http://versionzero.org"></a></h1>
      <p></p>
      <nav>
        <ul class="list">
        </ul>
      </nav>
      <ul class="social">
      </ul>
    </div>
  </aside>
  <main>

<article>
  <header>
    <h1 id="run-windows-cmds-in-wsl">Run Windows commands from the Windows Subsystem for Linux</h1>
    <p>Posted on Sat 09 April 2016 in <a href="http://versionzero.org/category/systems.html">Systems</a></p>
  </header>
  <div>
    <h2>Introduction</h2>
<p>A while back, <a href="http://www.microsoft.com/">Microsoft</a> announced a
partnership with <a href="http://www.canonical.com">Canonical</a> that would
bring native <a href="https://blogs.windows.com/windowsexperience/2016/04/06/announcing-windows-10-insider-preview-build-14316/">support for
Linux</a>
to the Windows echo-system.</p>
<p>The partnership includes creating an addition to Windows 10, through a
new subsystem called Windows Subsystem for Linux, that allows Windows
to run and use a subset of an Ubuntu distribution. A working version
of this system&mdash;still in beta&mdash;was release on April 6th 2016
and is available through the <a href="https://blogs.windows.com/windowsexperience/2016/04/06/announcing-windows-10-insider-preview-build-14316/">Windows Insider
Program</a>. You
can also watch the project activity on the <a href="https://blogs.msdn.microsoft.com/commandline/">Windows Command Line Tools
For Developers</a> blog.</p>
<p>One of the problems with the Windows Subsystem for Linux (herein WSL)
is that it <em>only</em> supports running Linux tasks. According to
Microsoft, "<a href="https://blogs.windows.com/buildingapps/2016/03/30/run-bash-on-ubuntu-on-windows/">you cannot interact with Windows applications and
tools.</a>"
That is to say, if you launch <code>bash</code>, you cannot run, say,
<code>notepad.exe</code> from <em>within</em> <code>bash</code>. This means that Windows system
tasks cannot be automated. This is unfortunate, since using the
assortment of Linux tools perform some of these tasks would be ideal.</p>
<p>Systems like <a href="https://cygwin.com">Cygwin</a> (or more interestingly,
<a href="http://babun.github.io">Babun</a>) can inter-operate with Windows
application. However, this is due to the way the systems were
implemented. Cygwin, for instance, is a collection of Unix tool that
have been ported and compiled to run on Windows. This is stark
contrast to how WSL operates, which actually runs native Linux
applications.</p>
<p>The purposes of this post is to demonstrate that it is possible to
escape the Linux sand-box and run native Windows applications.</p>
<h2>The Approach</h2>
<p>The way in which WSL works does not allow us to escape the Linux
sand-box directly. To do this we will require a set of tools
specifically crafted for this task.</p>
<p>A simple tool, available
<a href="https://github.com/versionzero/winrun">here</a>, allows Linux
applications to interact with Windows. It operates by monitoring the
Windows filesystem for changes. If a new file is detected, it is read
and the command it contains is run.</p>
<p>Consider the case of <code>notepad.exe</code>. If we would like to launch it, we
need only create a new file, containing the following:</p>
<div class="highlight"><pre><span></span>C:/Windows/notepad.exe
</pre></div>


<p>Note that we use <code>/</code> slashes. This is to avoid having to deal with
double escaping the path, using <code>\\\\</code> as a delimiter.</p>
<p>Our utility will notice the creation of a new file and starts the
process churning.</p>
<p>Communicating the application name to the WSL is now simply a matter
of creating a new text file with the command we care to run. There are
many ways to do this in Linux, but a simple one takes the following
form:</p>
<div class="highlight"><pre><span></span><span class="nb">echo</span> <span class="s2">&quot;C:/Windows/notepad.exe&quot;</span> &gt; /mnt/c/winrun/run
</pre></div>


<p>Where <code>run</code> is an arbitrary name of a text file, and <code>/mnt/c/winrun</code>
is a directory that can be read and written to by both Windows and
Linux.</p>
<p>Note that the current implementation of the monitoring tool will not
delete the <code>run</code> file, so we need to clean it up ourselves.</p>
<h2>How it Works</h2>
<p>The monitoring tools is a plain vanilla Win32 application. When run,
it opens <code>C:\winrun</code> and monitors the directory for the creation of
new files.</p>
<p>The processes by which it accomplishes this is a somewhat complex, but
that is generally the nature of Win32 programming.</p>
<p>First, we use the
<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa365465(v=vs.85).aspx"><code>ReadDirectoryChangesW</code></a>
API call to detect any change in the directory we are monitoring. When
a file is added,</p>
<p>If you have any questions or comments for me, please leave them bellow.</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://versionzero.org/tag/windows.html">Windows</a>
      <a href="http://versionzero.org/tag/linux.html">Linux</a>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'versionzero';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
        <p>&copy; Ben Burnett </p>
<p>Based on <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57348140-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->



<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Run Windows commands from the Windows Subsystem for Linux",
  "headline": "Run Windows commands from the Windows Subsystem for Linux",
  "datePublished": "2016-04-09 12:00:00-06:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Ben Burnett",
    "url": "http://versionzero.org/author/ben-burnett.html"
  },
  "image": "{{ SITEURL }}/{{ THEME_STATIC_DIR }}/img/profile.png",
  "url": "http://versionzero.org/blog/2016/04/09/run-windows-cmds-in-wsl/index.html",
  "description": "They said it couldn't be done."
}
</script></body>
</html>